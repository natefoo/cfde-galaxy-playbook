---

#
# Job runner plugin configuration
#
runners:
  local:
    load: galaxy.jobs.runners.local:LocalJobRunner
    workers: 2
  slurm:
    load: galaxy.jobs.runners.slurm:SlurmJobRunner
    workers: 4
    drmaa_library_path: /usr/lib64/libdrmaa.so.1
    invalidjobexception_retries: 5
    internalexception_retries: 5
  ls6:
    load: galaxy.jobs.runners.pulsar:PulsarMQJobRunner
    manager: ls6_{{ galaxy_instance_codename }}
    amqp_url: {{ pulsar_message_queue_url }}
    galaxy_url: https://{{ galaxy_instance_hostname }}
    #persistence_directory: /.../pulsar_amqp_ack
    #amqp_acknowledge: true
    #amqp_ack_republish_time: 1200
    #amqp_consumer_timeout: 2.0
    #amqp_publish_retry: true
    #amqp_publish_retry_max_retries: 60

handling:
  assign:
    - db-skip-locked
  max_grab: 16
  ready_window_size: 32

execution:
  default: tpv_dispatcher
  environments:
    local:
      runner: local
    tpv_dispatcher:
      runner: dynamic
      type: python
      function: map_tool_to_destination
      rules_module: tpv.rules
      tpv_config_files:
        - https://raw.githubusercontent.com/galaxyproject/tpv-shared-database/main/tools.yml
        - "{{ tpv_config_dir }}/defaults.yaml"
        #- "{{ tpv_config_dir }}/environments.yaml"
        #- "{{ tpv_config_dir }}/tools.yaml"

limits:
  - type: registered_user_concurrent_jobs
    value: 20
